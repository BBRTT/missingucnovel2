<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>완전 시스템 구축</title>

<link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo&family=Suit:wght@300;400;500&display=swap" rel="stylesheet">

<style>
/* ------------------------------
   전체 페이지
------------------------------ */
html, body {
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  background: #fafafa;
  font-family: 'SUIT', sans-serif;
}

/* ------------------------------
   인트로
------------------------------ */
#intro {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #fafafa;
  z-index: 1000;
  transition: opacity 0.8s ease;
}

.intro-inner {
  text-align: center;
}

.intro-inner h1 {
  font-family: 'Nanum Myeongjo', serif;
  font-size: 32px;
  margin-bottom: 16px;
}

.intro-inner .title-divider {
  width: 100vw;
  height: 2px;
  background: rgba(0,0,0,0.15);
  box-shadow:
    0 6px 20px rgba(0,0,0,0.45),
    0 3px 6px rgba(0,0,0,0.35);
  margin: 16px 0;
}

.intro-inner p {
  font-size: 14px;
  color: #666;
}

#intro.hide {
  opacity: 0;
  pointer-events: none;
}

/* ------------------------------
   스토리
------------------------------ */
#story {
  max-width: 600px;
  margin: 0 auto;
  padding: 0 20px;
  text-align: center;
  line-height: 1.2;
  letter-spacing: -0.015em;
}

/* 글과 이미지 공통 */
.line, .line img, .loading-dots {
  opacity: 0;
  transition: opacity 0.4s ease;
  margin-bottom: 20px;
}

.line.show, .line img.show, .loading-dots.show {
  opacity: 1;
}

/* 사라질 때 */
.line.hide, .line img.hide, .loading-dots.hide {
  opacity: 0;
}

/* 이미지 */
.line img {
  max-width: 90%;
  height: auto;
  margin: 0 5%;
  border-radius: 12px;
  display: block;
}

/* 로딩 점 */
.loading-dots span {
  display: inline-block;
  animation: blink 1s infinite;
  font-size: 24px;
  margin: 0 2px;
}
.loading-dots span:nth-child(2) { animation-delay: 0.2s; }
.loading-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes blink {
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
}

/* BGM 버튼 숨김 (자동 시작) */
audio { display: none; }
</style>
</head>
<body>

<!-- 인트로 -->
<div id="intro">
  <div class="intro-inner">
    <h1>제발 되라 제발</h1>
    <div class="title-divider"></div>
    <p>화면을 터치하면 이야기가 시작됩니다</p>
    <p>※ 본 글에는 사운드가 포함되어 있습니다 ※</p>
  </div>
</div>

<!-- 오디오 -->
<audio id="bgm1" src="모야.mp3"></audio>
<audio id="bgm2" src="살만찌고.mp3"></audio>
<audio id="bgm3" src="초콜렛군 오렌지양.mp3"></audio>
<audio id="bgm4" src="bgm4.mp3"></audio>
<audio id="bgm5" src="bgm5.mp3"></audio>

<!-- 스토리 -->
<div id="story">
  <p class="line fade bgm3-start" data-text>안녕하세요! 잘 지내셨나요?</p>
  <p class="line fade" data-text>예전의 전 유씨노벨 작가가 되는게 꿈이었어요. 그리고 아직도 그 꿈을 잊지 못하고 이렇게 만들어버렸답니다.^^.</p>
  <p class="line fade" data-text>그때의 감성이 잘 묻어나는 글이 되길 바라면서 써봅니다. 그럼 재밌게 봐주세요!</p>

  <!-- 로딩 넣고 싶을 때 -->
  <div class="loading-dots">
    <span>.</span><span>.</span><span>.</span>
  </div>

  <p class="line bgm2-start" data-text>첫문장</p>
  <img class="line" src="KakaoTalk_20251229_220819096.jpg" alt="하루토">
</div>

<script>
// ------------------------------
// BGM 페이드
// ------------------------------
function fadeInSmooth(audio, duration = 1500) {
  audio.pause();
  audio.currentTime = 0;
  audio.volume = 0;
  audio.play();
  const start = performance.now();
  function step(now) {
    const t = Math.min((now-start)/duration,1);
    audio.volume = Math.sin(t*Math.PI/2);
    if(t<1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

function fadeOutSmooth(audio, duration = 1500, callback){
  const start = performance.now();
  const initial = audio.volume;
  function step(now){
    const t = Math.min((now-start)/duration,1);
    audio.volume = initial*Math.cos(t*Math.PI/2);
    if(t<1) requestAnimationFrame(step);
    else{
      audio.pause();
      audio.currentTime=0;
      if(callback) callback();
    }
  }
  requestAnimationFrame(step);
}

// ------------------------------
// 스토리 타이핑 & 페이드
// ------------------------------
const lines = document.querySelectorAll(".line, .loading-dots");
let index = 0;
let currentBgm = null;
let introDone = false;

function typeLine(line, callback, speed=50){
  if(line.tagName === "IMG" || line.classList.contains("loading-dots")) {
    line.classList.add("show");
    if(callback) callback();
    return;
  }
  const fullText = line.dataset.text;
  line.textContent = "";
  line.classList.add("show");
  let i=0;
  const interval = setInterval(()=>{
    line.textContent += fullText[i];
    i++;
    if(i>=fullText.length){
      clearInterval(interval);
      if(callback) callback();
    }
  }, speed);
}

// ------------------------------
// 클릭 이벤트
// ------------------------------
document.body.addEventListener("click",()=>{
  if(!introDone){
    introDone = true;
    document.getElementById("intro").classList.add("hide");
    typeLine(lines[0]);
    index++;
    // 첫 BGM
    if(lines[0].classList.contains("bgm1-start")){
      currentBgm = document.getElementById("bgm1");
      fadeInSmooth(currentBgm);
    }
    return;
  }
  if(index>=lines.length) return;

  const currentLine = lines[index];

  // 이전 글 페이드아웃
  if(index>0){
    const prevLine = lines[index-1];
    prevLine.classList.remove("show");
    prevLine.classList.add("hide");
  }

  // 현재 글 타이핑/보여주기
  typeLine(currentLine, ()=>{
    // 자동 스크롤
    currentLine.scrollIntoView({behavior:"smooth", block:"center"});
  });

  // BGM 전환
  if(currentLine.classList.contains("bgm1-start")) bgmChange("bgm1");
  if(currentLine.classList.contains("bgm2-start")) bgmChange("bgm2");
  if(currentLine.classList.contains("bgm3-start")) bgmChange("bgm3");
  if(currentLine.classList.contains("bgm4-start")) bgmChange("bgm4");
  if(currentLine.classList.contains("bgm5-start")) bgmChange("bgm5");

  index++;
});

// ------------------------------
// BGM 전환
// ------------------------------
function bgmChange(id){
  const nextBgm = document.getElementById(id);
  if(currentBgm && currentBgm!==nextBgm){
    fadeOutSmooth(currentBgm,1600,()=>{
      currentBgm = nextBgm;
      fadeInSmooth(currentBgm,1500);
    });
  } else if(!currentBgm){
    currentBgm = nextBgm;
    fadeInSmooth(currentBgm,1500);
  }
}
</script>
</body>
</html>
